<script>
document.addEventListener('DOMContentLoaded', () => {

  // Элементы лайтбокса
  const lightbox = document.getElementById('lightbox');
  const lightboxImg = document.getElementById('lightbox-image');
  const lightboxCaption = document.getElementById('lightbox-caption');
  const closeBtn = document.getElementById('lightbox-close');
  const prevBtn = document.getElementById('lightbox-prev');
  const nextBtn = document.getElementById('lightbox-next');

  // Галерея
  const items = Array.from(document.querySelectorAll('.gallery-item'));
  let currentIndex = 0;

  // Открытие
  function openLightbox(index) {
    currentIndex = index;
    showImage(currentIndex);
    lightbox.classList.add('is-open');
    document.body.style.overflow = 'hidden';
  }

  // === ГЛАВНАЯ ЛОГИКА ===
  function showImage(index) {
    const item = items[index];
    if (!item) return;

    const img = item.querySelector('img');

    // имя файла (IMG_8167.jpeg и т.д.)
    const pageSrc = img.getAttribute('src');
    const fileName = pageSrc.split('/').pop();

    // папка = номер картинки + 1
    const folderNumber = index + 1;

    // путь для лайтбокса
    const lightboxSrc = `images/${folderNumber}/${fileName}`;

    const title =
      item.getAttribute('data-title') ||
      img.getAttribute('alt') ||
      '';

    lightboxImg.src = lightboxSrc;
    lightboxImg.alt = title;
    lightboxCaption.textContent = title;
  }

  function showNext() {
    currentIndex = (currentIndex + 1) % items.length;
    showImage(currentIndex);
  }

  function showPrev() {
    currentIndex = (currentIndex - 1 + items.length) % items.length;
    showImage(currentIndex);
  }

  // Клик по картинкам
  items.forEach((item, index) => {
    item.addEventListener('click', (e) => {
      e.preventDefault();
      openLightbox(index);
    });
  });

  // Кнопки
  if (nextBtn) {
    nextBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      showNext();
    });
  }

  if (prevBtn) {
    prevBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      showPrev();
    });
  }

  // Закрытие
  function closeLightbox() {
    lightbox.classList.remove('is-open');
    document.body.style.overflow = '';
    lightboxImg.src = '';
  }

  if (closeBtn) {
    closeBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      closeLightbox();
    });
  }

  lightbox.addEventListener('click', (e) => {
    if (e.target === lightbox) {
      closeLightbox();
    }
  });

  // Клавиатура
  document.addEventListener('keydown', (e) => {
    if (!lightbox.classList.contains('is-open')) return;

    if (e.key === 'Escape') closeLightbox();
    if (e.key === 'ArrowRight') showNext();
    if (e.key === 'ArrowLeft') showPrev();
  });

  // Свайп
  let touchStartX = 0;
  let touchEndX = 0;

  function handleGesture() {
    const dx = touchEndX - touchStartX;
    if (Math.abs(dx) < 40) return;
    dx < 0 ? showNext() : showPrev();
  }

  const swipeArea = lightboxImg;

  swipeArea.addEventListener('touchstart', (e) => {
    if (!lightbox.classList.contains('is-open')) return;
    touchStartX = e.touches[0].clientX;
    touchEndX = touchStartX;
  }, { passive: true });

  swipeArea.addEventListener('touchmove', (e) => {
    if (!lightbox.classList.contains('is-open')) return;
    touchEndX = e.touches[0].clientX;
  }, { passive: true });

  swipeArea.addEventListener('touchend', () => {
    if (!lightbox.classList.contains('is-open')) return;
    handleGesture();
  });

  // Год
  const yearEl = document.getElementById('year');
  if (yearEl) {
    yearEl.textContent = new Date().getFullYear();
  }

});
</script>
